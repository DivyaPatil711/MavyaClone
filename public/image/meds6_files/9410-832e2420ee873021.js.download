(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9410],{3414:function(e,t,n){"use strict";n.d(t,{O:function(){return i},C:function(){return u}});var r=n(19989);function a(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function o(){var e=a(["\n  mutation SaveSearch($saveSearchInput: SaveSearchInput) {\n    saveSearch(saveSearchInput: $saveSearchInput) {\n      saveStatus\n    }\n  }\n"]);return o=function(){return e},e}function c(){var e=a(["\n  query getPatientPastMedicineSearches($patientId: ID!, $type: SEARCH_TYPE) {\n    getPatientPastMedicineSearches(patientId: $patientId, type: $type) {\n      searchType\n      typeId\n      name\n      image\n    }\n  }\n"]);return c=function(){return e},e}var i=(0,r.ZP)(o()),u=(0,r.ZP)(c())},29410:function(e,t,n){"use strict";n.r(t),n.d(t,{MedicineSearch:function(){return q}});var r=n(34051),a=n.n(r),o=n(85893),c=n(23908),i=n(9669),u=n.n(i),s=n(91322),l=n(99210),d=n(15144),h=n(63093),f=n(88385),v=n(11163),p=n(67294),g=n(88865),_=n(37343),S=n.n(_),m=n(3414),y=n(84069),x=n(11124),A=n(33640),M=n(21605),k=n(21810),b=n(25424),w=n(51931),I=n(33342),P=n(13794),j=n(5152),C=n(65534);function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(s){return void n(s)}i.done?t(u):Promise.resolve(u).then(r,a)}function N(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){L(o,r,a,c,i,"next",e)}function i(e){L(o,r,a,c,i,"throw",e)}c(void 0)}))}}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);c=!0);}catch(u){i=!0,a=u}finally{try{c||null==n.return||n.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D=(0,j.default)((function(){return n.e(6389).then(n.bind(n,76389)).then((function(e){return e.default}))}),{loadableGenerated:{webpack:function(){return[76389]}},ssr:!1}),E=(0,j.default)((function(){return n.e(7989).then(n.bind(n,7989)).then((function(e){return e.default}))}),{loadableGenerated:{webpack:function(){return[7989]}},ssr:!1}),B=(0,j.default)((function(){return n.e(6462).then(n.bind(n,76462)).then((function(e){return e.default}))}),{loadableGenerated:{webpack:function(){return[76462]}},ssr:!1}),F=[],O=1,Z=0,H=0,z=function(){var e=N(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===n||void 0===n?void 0:n.patient){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.mutate({mutation:m.O,variables:{saveSearchInput:n},fetchPolicy:"no-cache"}).catch((function(e){console.error("Failed to save Patient search",e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=function(e){var t=(0,p.useRef)(null),n=(0,p.useRef)(null),r=(0,p.useRef)(null),i=e.lazyLoad,_=e.fullSearch,m=e.displayedNudgeForSku,j=e.setDisplayedNudgeForSku,R=e.setIsSearchListOpen,L={url:"".concat(f.O3,_?"/fullSearch":"/search"),authToken:f.Hx},q=(0,x.x)(),V=(0,M.C)(k.Z),$=(0,M.C)((function(e){var t;return null===e||void 0===e||null===(t=e.cart)||void 0===t?void 0:t.showSearchPdp})),Y=(0,M.C)(I.Z),G=(0,M.C)(b.Z),U=(0,M.C)(w.Z),J=(0,p.useState)([]),K=J[0],W=J[1],Q=(0,p.useState)(""),X=Q[0],ee=Q[1],te=(0,p.useState)(!1),ne=te[0],re=te[1],ae=(0,p.useState)(!1),oe=ae[0],ce=ae[1],ie=(0,p.useState)(!1),ue=ie[0],se=ie[1],le=(0,p.useState)(!1),de=le[0],he=le[1],fe=(0,p.useRef)(null),ve=(null===fe||void 0===fe?void 0:fe.current)||null,pe=(0,p.useState)(!1),ge=pe[0],_e=pe[1],Se=(0,p.useState)(!1),me=Se[0],ye=Se[1],xe=(0,p.useState)(!1),Ae=xe[0],Me=xe[1],ke=(0,v.useRouter)(),be=(0,d.j)()&&sessionStorage.getItem("axdcCode")||"",we=function(){se(!1),R&&R(!1)},Ie=function(e){if(e){var t={patient:(null===V||void 0===V?void 0:V.id)||"",type:y.VO.MEDICINE,typeId:e.sku,typeName:e.name,image:e.thumbnail};z(q,t)}},Pe=function(e,t){return function(e,t,n){if((0,d.j)())try{return e?u().post(L.url,{token:G,query:n,page:O,productsPerPage:f.i3},{headers:{Authorization:L.authToken},cancelToken:null===t||void 0===t?void 0:t.token}):u().get("".concat(L.url,"?query=").concat(n).concat(G?"&token=".concat(G):""),{headers:{Authorization:L.authToken},cancelToken:t.token})}catch(r){return console.error("There was an error initialising turret search",r),Promise.reject(r)}}(_,t,e)},je=null===Y||void 0===Y?void 0:Y.zipcode,Ce=(0,h.Nr)(X,g.Do);(0,p.useEffect)((function(){var e=function(){var e=N(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===je||void 0===je?void 0:je.length)!==h.Zm){e.next=6;break}return e.next=4,u().post("".concat(f.Z9,"/v1/srcode"),{pincode:je},{headers:{Authorization:"".concat(f.rl)}});case 4:(null===(r=e.sent)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.sr_code)?sessionStorage.setItem("location_id",null===r||void 0===r||null===(n=r.data)||void 0===n?void 0:n.sr_code):sessionStorage.removeItem("location_id");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[je]),(0,p.useEffect)((function(){F=[],Z=0,H=0,O=1,Me(!1);var e=u().CancelToken.source();return Ce&&X.length>=1?(_e(!0),Pe(Ce,e).then((function(e){var t=e.data,n=null===t||void 0===t?void 0:t.data;if(n){var r=(_?n.products:n)||[];ce(0===r.length),F=r,H=r.length,Z=(_?n.matchingProducts:H)||0,W(r);var a=r.map((function(e){return e.sku})).filter((function(e){return e}));(0,P.Y)("product_list",{pl_type:"search",pl_details:{q:Ce},pl_page:1,pl_total:a.length,pl_products:a})}else ce(!0),W([]);_e(!1)})).catch((function(e){console.error(e,"Failed to get suggestions based on search query")}))):(ce(!1),W([]),_e(!1)),function(){e.cancel()}}),[Ce]);var Re=ue&&X.length>=1&&K&&K.length>0,Le=Re||de;(0,p.useEffect)((function(){var e=new IntersectionObserver((function(e){var t=T(e,1)[0];ye(t.isIntersecting)}),{root:null,rootMargin:"0px"});return ve&&Re&&e.observe(ve),function(){e.disconnect()}}),[ve,Re]),(0,p.useEffect)((function(){me&&(H<Z&&function(){var e=u().CancelToken.source();Pe(Ce,e).then((function(e){var t=e.data,n=null===t||void 0===t?void 0:t.data;if(n){var r=n.products||[];ce(0===K.length),F=F.concat(r),W(F),O+=1,H+=(null===K||void 0===K?void 0:K.length)||0,Z=n.matchingProducts||0,Me(H<Z)}}))}(),ye(!1))}),[me]),(0,p.useEffect)((function(){Re||(_e(!1),O=1,F=[],Z=0)}),[Re]);var Ne=function(e){var a,o,c;(null===r||void 0===r||null===(a=r.current)||void 0===a?void 0:a.contains(e.target))||(null===t||void 0===t||null===(o=t.current)||void 0===o?void 0:o.contains(e.target))||(null===n||void 0===n||null===(c=n.current)||void 0===c?void 0:c.contains(e.target))||(he(!1),se(!1),R&&R(!1))};(0,p.useEffect)((function(){return document.addEventListener("mousedown",Ne),function(){document.removeEventListener("mousedown",Ne)}}),[]);var Te=function(){if(ne){var e=K.filter((function(e){var t=e.type;return"suggestion"===(null===t||void 0===t?void 0:t.toLowerCase())})).map((function(e){return e.name})).slice(0,5),t=K.filter((function(e){var t=e.type;return"product"===(null===t||void 0===t?void 0:t.toLowerCase())})).map((function(e){return e.sku})).slice(0,5),n={keyword:X,source:ke.pathname===l.r.medicines()?"Pharmacy Home":"Pharmacy List",results:null===K||void 0===K?void 0:K.length,"User type":U,City:(null===Y||void 0===Y?void 0:Y.city)||"",Pincode:(null===Y||void 0===Y?void 0:Y.zipcode)||"","axdc code":be,top_results:t.toString(),top_keywords:e.toString()};(0,s.R_)("Pharmacy Search",n)}},De=function(e){(0,C.nx)({event:"search_for_pharmacy",search_type:"",search_query:e,search_through:""}),ke.push(l.r.searchByMedicine("search-medicines",e.replace(/\s/g,"-"))).then((function(){(null===K||void 0===K?void 0:K.length)&&Le&&!_&&Te(),function(e){if(e){var t={patient:(null===V||void 0===V?void 0:V.id)||"",type:y.VO.MEDICINE_SEARCH,typeId:e,typeName:"",image:""};z(q,t)}}(e)})).catch((function(e){console.error("Failed to redirect to search page",e)}))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"".concat(S().medicineSearchForm," ").concat($?S().searchBoxPDP:""," "),ref:t,children:[(0,o.jsx)(c.Input,{fullWidth:!0,id:"searchProduct",placeholder:"Search medicines, brands and more",errorMsg:oe,className:"".concat(S().searchInput),inputText:X.replace(/\s+/gi," ").trimLeft(),onKeyDown:function(e){re(!0),X.length>1&&"Enter"===e.key&&De(X),"Enter"===e.key&&(he(!1),se(!1),R&&R(!1),re(!1))},onChange:function(e){ee(e.target.value),e.target.value.length>=1?(se(!0),he(!1),R&&R(!0)):(ce(!1),se(!1),he(!0),R&&R(!1))},onFocus:function(){(null===X||void 0===X?void 0:X.length)>=1?(se(!0),he(!1),R&&R(!0)):(se(!1),he(!0),R&&R(!1))},onBlur:function(){(null===X||void 0===X?void 0:X.length)>=1&&(null===K||void 0===K?void 0:K.length)&&Le&&!_&&Te(),re(!1)},autoComplete:"off"}),(0,o.jsx)(c.Button,{color:"secondary",disabled:X.length<3,className:S().searchIco,onClick:function(){return ke.push(l.r.searchByMedicine("search-medicines",X))},children:(0,o.jsx)("i",{className:"icon-ic-search"})})]}),oe?(0,o.jsxs)("span",{className:S().noData,children:["Hit enter to search for ",(0,o.jsxs)("b",{children:["'",X,"'"]})]}):"",Le&&(0,o.jsxs)("div",{className:"".concat(S().autoSearchPopover," ").concat(Le?S().fixHeight:""," \n          ").concat(i?S().uploadSearchMain:null),ref:n,children:[de&&(0,o.jsx)(D,{}),Re&&(0,o.jsx)(o.Fragment,{children:ge?(0,o.jsx)("div",{className:S().searchResultsLoadRoot,children:(0,o.jsx)(A.Z,{customClass:S().searchResultsLoading})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"".concat(S().searchList," ").concat(i?S().uploadSearchList:null),children:(0,o.jsxs)("ul",{id:"random",children:[K.map((function(e,t){return{suggestion:(0,o.jsx)(E,{suggestionText:e.name,suggestionIndex:t,searchText:X,setSearchText:ee,hideSuggestions:we},"search-suggestor-text-suggestion-".concat(e.name)),product:(0,o.jsx)(B,{suggestedQtyRef:r,productIndex:t,searchResults:K,setSearchText:ee,searchText:X,displayedNudgeForSku:m,setDisplayedNudgeForSku:j,performMedicineSaveSearch:Ie},"search-suggestor-product-suggestion-".concat(e.sku))}[e.type.toLowerCase()]})),i&&(0,o.jsx)("div",{className:S().seeMoreTag,ref:fe,children:Ae?(0,o.jsx)(c.CircularProgress,{width:"22",height:"22",color:"secondary"}):null})]})}),!_&&(0,o.jsx)("div",{className:S().viewResult,children:(0,o.jsx)(c.Button,{color:"secondary",className:S().viewAllResultBtn,onClick:function(){we(),(0,C.nx)({event:"search_for_pharmacy",search_type:"",search_query:X,search_through:""}),De(X)},children:"View All Results"})})]})})]})]})};t.default=q},37343:function(e){e.exports={medicineSearchContainer:"MedicineAutoSearch_medicineSearchContainer__HqfkF",medicineSearchForm:"MedicineAutoSearch_medicineSearchForm__jJxYU",seeMoreTag:"MedicineAutoSearch_seeMoreTag__9IunB",searchInput:"MedicineAutoSearch_searchInput__AZSSS",searchBtn:"MedicineAutoSearch_searchBtn__ZnKoX",autoSearchPopover:"MedicineAutoSearch_autoSearchPopover__W8bJt",scroll:"MedicineAutoSearch_scroll__UmAAZ",searchList:"MedicineAutoSearch_searchList__fyMpy",viewResult:"MedicineAutoSearch_viewResult__VG5hP",viewAllResultBtn:"MedicineAutoSearch_viewAllResultBtn__l0DzD",itemSelected:"MedicineAutoSearch_itemSelected__9_JB_",searchBtnDisabled:"MedicineAutoSearch_searchBtnDisabled__DmGt_",progressLoader:"MedicineAutoSearch_progressLoader__Tnd0f",helpText:"MedicineAutoSearch_helpText__hAKDU",noData:"MedicineAutoSearch_noData__8NP2f",fixHeight:"MedicineAutoSearch_fixHeight__HMrzC",uploadSearchMain:"MedicineAutoSearch_uploadSearchMain__YunCY",uploadSearchList:"MedicineAutoSearch_uploadSearchList__L50Fw",searchIco:"MedicineAutoSearch_searchIco__OwVqA",searchBoxPDP:"MedicineAutoSearch_searchBoxPDP__t9ZVY",searchResultsLoadRoot:"MedicineAutoSearch_searchResultsLoadRoot__kvVyH",searchResultsLoading:"MedicineAutoSearch_searchResultsLoading__18DDF"}}}]);