"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{81573:function(e,n,i){i.d(n,{e:function(){return f},IQ:function(){return b}});var l=i(85893),t=i(11451),a=i(53685),o=i(27361),u=i.n(o),r=i(67294),s=i(11124),c=i(5558),d=i(84069),v=i(40290),p=i(88385),f=r.createContext({circlePlans:null,cashbacks:null,circlePlanInCart:null,setCirclePlanInCart:null,isCircleApplied:!1,setIsCircleApplied:null,isUserCircle:!1,setIsUserCircle:null,subscriptionCartDetails:null,setSubscriptionCartDetails:null,userSubscriptionsUpdated:!1,setUserSubscriptionsUpdated:null,userSubscriptions:null,setUserSubscriptions:null,fetchUpdatedSubscriptions:null,selectedPlan:null,setSelectedPlan:null,isPlanFetched:!1,packageIds:null,getMembershipsDetails:function(e){},membershipDetails:null,userSavings:null,subscriptionDetailsLoading:!1,redirection:!1}),b=function(e){var n=(0,a.aC)().isSignedIn,i=(0,s.x)(),o=S(),c=g(),d=(0,r.useState)(!1),b=d[0],P=d[1],h=(0,r.useState)(!1),C=h[0],I=h[1],m=(0,r.useState)([]),y=m[0],_=m[1],D=(0,r.useState)(!1),O=D[0],E=D[1],A=(0,r.useState)(null),U=A[0],L=A[1],k=(0,r.useState)(null),w=k[0],N=k[1],x=(0,r.useState)(!1),R=x[0],q=x[1],F=(0,r.useState)(null),j=F[0],G=F[1],J=(0,r.useState)(null),T=J[0],B=J[1],H=(0,r.useState)({apolloSubscriptions:null,userSubscriptionId:null,benefits:[],faqs:[],termsAndConditions:[],bannerInfo:null,expiryDate:null,remainingDaysToExpire:null,isCircle:!1,logoURL:null,renew:!1,active:!1,isUpdated:!1,groupPlan:null}),M=H[0],Q=H[1],V=(0,r.useState)(!0),X=V[0],z=V[1],K=(0,r.useState)(!1),W=K[0],Y=K[1],Z=(0,r.useState)({pharmaSavings:0,consultSavings:0,deliverySavings:0,totalSavings:0,benefits:[]}),$=Z[0],ee=Z[1];(0,r.useEffect)((function(){G(JSON.parse(localStorage.getItem("userSubscriptions")||null))}),[R]),(0,r.useEffect)((function(){var e=!!Object.keys(j||{}).find((function(e){var n;return null===j||void 0===j||null===(n=j[e])||void 0===n?void 0:n.find((function(e){var n;return"active"===(null===e||void 0===e?void 0:e.status)&&"circle plan"===(null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase())}))}));P(e)}),[j]),(0,r.useEffect)((function(){if(n===v.J.SIGNEDIN){if(!(null===w||void 0===w?void 0:w.circleAddedToCart)||w.userSubscriptionId)L(null),B(null);else if(!(null===w||void 0===w?void 0:w.userSubscriptionId)&&o){var e=o.find((function(e){var n;return e.subPlanId===(null===w||void 0===w||null===(n=w.planPurchaseDetails)||void 0===n?void 0:n.subPlanId)}));e&&L(e)}E(!!(null===w||void 0===w?void 0:w.subscriptionApplied))}}),[w,o,n]),(0,r.useEffect)((function(){w&&o&&I(!0)}),[T,w]),(0,r.useEffect)((function(){!function(){var e,n,i,l,t=[];if((null===j||void 0===j||null===(e=j.HDFC)||void 0===e?void 0:e.length)&&"active"==(null===(n=j.HDFC[0])||void 0===n?void 0:n.status)){var a="HDFC:".concat(j.HDFC[0].plan_id);t.push(a)}if((null===j||void 0===j||null===(i=j.APOLLO)||void 0===i?void 0:i.length)&&"active"==(null===(l=j.APOLLO[0])||void 0===l?void 0:l.status)){var o="APOLLO:".concat(j.APOLLO[0].plan_id);t.push(o)}if(T){var u="APOLLO:".concat(T.subPlanId);t.push(u)}_(t)}()}),[j,T]),(0,r.useEffect)((function(){U?(B(U),localStorage.setItem("CIRCLEPlan",JSON.stringify(U))):localStorage.removeItem("CIRCLEPlan"),E(!!(null===w||void 0===w?void 0:w.subscriptionApplied))}),[U,w]);return(0,l.jsx)(f.Provider,{value:{circlePlans:o,cashbacks:c,circlePlanInCart:U,setCirclePlanInCart:L,subscriptionCartDetails:w,setSubscriptionCartDetails:N,isCircleApplied:O,setIsCircleApplied:E,isUserCircle:b,setIsUserCircle:P,userSubscriptions:j,setUserSubscriptions:G,userSubscriptionsUpdated:R,setUserSubscriptionsUpdated:q,fetchUpdatedSubscriptions:function(){var e={},l={},a=localStorage.getItem("mobile_num")||"";(null===a||void 0===a?void 0:a.length)>0&&"null"!==a&&n===v.J.SIGNEDIN?i.query({query:t.uA,variables:{mobile_number:a,status:["active","deferred_active","deferred_inactive","disabled"]},fetchPolicy:"no-cache"}).then((function(n){var i=u()(n,"data.GetSubscriptionsOfUserByStatus.response",null);i&&(Object.keys(i).forEach((function(n){var t;(null===(t=i[n])||void 0===t?void 0:t.length)&&i[n].map((function(i){"active"==i.status?(e[n]||(e[n]=[]),e[n].push(i)):(l[n]||(l[n]=[]),l[n].push(i))}))})),localStorage.setItem("userSubscriptions",JSON.stringify(e)),localStorage.setItem("inactiveSubscriptions",JSON.stringify(l)),q(!0),G(e))})).catch((function(e){console.error("Unable to fetch updated subscriptions :( ",e)})):q(!1)},selectedPlan:T,setSelectedPlan:B,isPlanFetched:C,packageIds:y,getMembershipsDetails:function(e){i.query({query:t.QR,variables:{plan_id:p.VB[e.toString()].planId,mobile_number:localStorage.getItem("mobile_num")}}).then((function(n){var i,l,t,a,o,u,r,s,c,d=n.data,v=null===d||void 0===d||null===(i=d.GetAllUserSubscriptionsById)||void 0===i?void 0:i.response;if(v){var f,b=null===v||void 0===v||null===(l=v.group_plan)||void 0===l?void 0:l.meta,S=null===v||void 0===v||null===(t=v.savings)||void 0===t?void 0:t.savings,g={apolloSubscriptions:v,userSubscriptionId:null===v||void 0===v?void 0:v._id,benefits:null===v||void 0===v?void 0:v.benefits,faqs:null===b||void 0===b||null===(a=b.landing_page_meta_data)||void 0===a?void 0:a.FAQ,termsAndConditions:(null===b||void 0===b||null===(o=b.landing_page_meta_data)||void 0===o?void 0:o.TnC)||[],bannerInfo:null===b||void 0===b||null===(u=b.landing_page_meta_data)||void 0===u?void 0:u.banner_info,expiryDate:(f=null===v||void 0===v?void 0:v.end_date,new Date(f)),remainingDaysToExpire:Number(null===v||void 0===v?void 0:v.expires_in),isCircle:e==p.Md,logoURL:null===b||void 0===b||null===(r=b.landing_page_meta_data)||void 0===r?void 0:r.group_plan_logo_url,renew:null===v||void 0===v?void 0:v.renewNow,active:(null===v||void 0===v?void 0:v.status)==p.yG.ACTIVE,isUpdated:(null===v||void 0===v?void 0:v.status)==p.yG.DEFERRED_ACTIVE,groupPlan:null===b||void 0===b||null===(s=b.group_plan)||void 0===s?void 0:s.name};Q(g);var P={benefits:null===v||void 0===v?void 0:v.benefits,pharmaSavings:null===S||void 0===S?void 0:S.pharma,consultSavings:null===S||void 0===S?void 0:S.consult,deliverySavings:null===S||void 0===S?void 0:S.delivery,totalSavings:null===v||void 0===v||null===(c=v.savings)||void 0===c?void 0:c.totalSavings};ee(P),z(!1)}else Y(!0)})).catch((function(e){console.error("Subscription Membership Details API err: ",e)}))},membershipDetails:M,subscriptionDetailsLoading:X,userSavings:$,redirection:W},children:e.children})},S=function(){var e=(0,r.useState)(null),n=e[0],i=e[1],l=(0,s.x)();return(0,r.useEffect)((function(){n||l.query({query:t.ck,variables:{plan_id:"CIRCLEPlan"},fetchPolicy:"cache-first"}).then((function(e){var n,l,t,a=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(l=n.GetPlanDetailsByPlanId)||void 0===l||null===(t=l.response)||void 0===t?void 0:t.plan_summary;i(a||[])})).catch((function(e){console.error(e,"Failed to fetch circle plan details")}))}),[n]),n},g=function(){var e=(0,r.useState)(null),n=e[0],i=e[1],l=(0,s.x)();return(0,r.useEffect)((function(){n||l.query({query:c.PD,fetchPolicy:"no-cache",variables:{plan_id:d.eX.CIRCLEPlan}}).then((function(e){var n,l,t,a;i((null===e||void 0===e||null===(n=e.data)||void 0===n||null===(l=n.GetCashbackDetailsOfPlanById)||void 0===l||null===(t=l.response)||void 0===t||null===(a=t.meta)||void 0===a?void 0:a.cashback)||null)})).catch((function(e){console.error("Failed to fetch Cashbacks configuration",e)}))}),[n]),n}},99091:function(e,n,i){i.d(n,{P:function(){return r}});var l=i(81573),t=i(63093),a=i(88385),o=i(67294);function u(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var r=function(){var e,n,i,r=(0,o.useContext)(l.e),s=(null===r||void 0===r||null===(e=r.circlePlanInCart)||void 0===e?void 0:e.currentSellingPrice)||(null===r||void 0===r||null===(n=r.circlePlanInCart)||void 0===n?void 0:n.price)||0,c=null===r||void 0===r||null===(i=r.circlePlans)||void 0===i?void 0:i.filter((function(e){return e.displayOnUI})),d=null===c||void 0===c?void 0:c.find((function(e){return null===e||void 0===e?void 0:e.defaultPack})),v=(0,t.IQ)(c)||a.RA;return function(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{},l=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),l.forEach((function(n){u(e,n,i[n])}))}return e}({defaultCirclePlan:d,defaultCirclePlanPrice:(null===d||void 0===d?void 0:d.currentSellingPrice)||(null===d||void 0===d?void 0:d.price)||a.RA,startingCirclePlanPrice:v,cartCirclePlanPrice:s},r)}}}]);