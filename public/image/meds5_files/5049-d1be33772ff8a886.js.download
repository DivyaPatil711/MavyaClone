"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5049],{15049:function(e,t,n){n.d(t,{LZ:function(){return _},vR:function(){return O},lD:function(){return T}});var r=n(34051),i=n.n(r),s=n(85893),o=n(9669),a=n.n(o),c=n(69274),d=n(63093),u=n(88385),l=n(44728),f=n(44266),v=n(7972),p=n(27361),A=n.n(p),g=n(7295),P=n(67294),y=n(8168),S=n(53685),I=n(11124),h=n(65534),m=n(3208),C=n(91322),D=n(99091),L=n(94153),E=n(40290);function k(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(d){return void n(d)}a.done?t(c):Promise.resolve(c).then(r,i)}function U(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){k(s,r,i,o,a,"next",e)}function a(e){k(s,r,i,o,a,"throw",e)}o(void 0)}))}}var _=P.createContext({editAddress:null,setEditAddress:function(e){},patientCurrentAddress:null,setPatientCurrentAddress:function(e){},isPincodeServiceable:!0,setIsPincodeServiceable:function(e){},isAddressListUpdated:!1,setIsAddressListUpdated:function(e){},isAddressUpdated:!1,setIsAddressUpdated:function(e){},pickAddressMobileDialogOpen:!1,setPickAddressMobileDialogOpen:function(e){},pickAddressDesktopDialogOpen:!1,setPickAddressDesktopDialogOpen:function(e){},isAddAddressCartDialogOpen:!1,setIsAddAddressCartDialogOpen:function(e){},isCartAddressLoading:!1,setIsCartAddressLoading:function(e){},currentLocation:null,paymentPage:null,currentLat:null,currentLong:null,currentPincode:null,placeId:null,city:null,state:null,country:null,area:null,cityId:null,stateId:null,isUserDeniedLocationAccess:null,showPincodeModal:!1,headerPincodeError:!1,setCurrentLocation:function(e){},setCurrentLat:function(e){},setCurrentLong:function(e){},setCurrentPincode:function(e){},locateCurrentLocation:function(){return Promise.resolve(!0)},setPlaceId:function(e){},setCity:function(e){},setState:function(e){},setCountry:function(e){},setArea:function(e){},setStateId:function(e){},setCityId:function(e){},getCurrentLocationPincode:function(e,t,n){return Promise.resolve(!0)},getPlaceDetailsPincode:function(e,t){return Promise.resolve(!0)},setIsUserDeniedLocationAccess:function(e){},setShowPincodeModal:function(e){},setHeaderPincodeError:function(e){}}),b=!1,O=function(e){var t=(0,P.useState)(!1),n=t[0],r=t[1],o=(0,P.useState)(!1),p=o[0],k=o[1],O=(0,P.useState)(null),T=O[0],N=O[1],w=(0,P.useState)((null===e||void 0===e?void 0:e.isPaymentPage)||!1),x=w[0],M=w[1],B=(0,P.useState)(""),R=B[0],G=B[1],H=(0,P.useState)(null),z=H[0],Z=H[1],F=(0,P.useState)(null),J=F[0],q=F[1],V=(0,P.useState)(""),W=V[0],Y=V[1],j=(0,P.useState)(""),K=j[0],Q=j[1],X=(0,P.useState)(""),$=X[0],ee=X[1],te=(0,P.useState)(""),ne=te[0],re=te[1],ie=(0,P.useState)(""),se=ie[0],oe=ie[1],ae=(0,P.useState)(""),ce=ae[0],de=ae[1],ue=(0,P.useState)(null),le=ue[0],fe=ue[1],ve=(0,P.useState)(null),pe=ve[0],Ae=ve[1],ge=(0,P.useState)(null),Pe=ge[0],ye=ge[1],Se=(0,P.useState)(!1),Ie=Se[0],he=Se[1],me=(0,P.useState)(!1),Ce=me[0],De=me[1],Le=(0,P.useState)(null),Ee=Le[0],ke=Le[1],Ue=(0,P.useState)(!1),_e=Ue[0],be=Ue[1],Oe=(0,P.useState)(!1),Te=Oe[0],Ne=Oe[1],we=(0,P.useState)(!1),xe=we[0],Me=we[1],Be=(0,P.useState)(!0),Re=Be[0],Ge=Be[1],He=(0,P.useState)(!1),ze=He[0],Ze=He[1],Fe=(0,g.d)(),Je=Fe.cartItems,qe=Fe.cartShipments,Ve=Fe.deliveryAddresses,We=Fe.deliveryAddressId,Ye=Fe.pharmaAddressDetails,je=Fe.setMedicineAddress,Ke=Fe.setPharmaAddressDetails,Qe=Fe.setDeliveryAddresses,Xe=Fe.setUserActionPayload,$e=(0,D.P)(),et=$e.isUserCircle,tt=$e.isCircleApplied,nt=$e.cartCirclePlanPrice,rt=(0,I.x)(),it=(0,S.aC)(),st=it.currentPatient,ot=it.isSignedIn,at=(st||{}).id,ct=void 0===at?"":at,dt=null===Ye||void 0===Ye?void 0:Ye.pincode;(0,P.useEffect)((function(){M(null===e||void 0===e?void 0:e.isPaymentPage)}),[null===e||void 0===e?void 0:e.isPaymentPage]);var ut=function(){var e=U(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){var n=(0,l.tp)(),r=function(n){var r=n.latitude,i=n.longitude;Z(r.toString()),q(i.toString()),ye(!1),ft(r.toString(),i.toString(),c.R.AUTO).then((function(t){e(t)})).catch((function(e){t(e)}))},i=function(e){ye(!0),console.error(e.message),t(!0)};n!==l.uc.PHONEPE_SWITCH?n!==l.uc.PAYTM_MINIAPP?navigator.geolocation.getCurrentPosition((function(e){var t=e.coords,n=t.latitude,i=t.longitude;r({latitude:n,longitude:i})}),(function(e){i(e)}),u.yp):(0,f.UZ)(r,i):(0,v.o)(r,i)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),lt=function(e,t,n,i,s){var o,a=function(e,t){var n=e.find((function(e){return(0,d.IB)(t,e.address_components||[])}));return n?(0,d.IB)(t,n.address_components||[]):""}(e,"postal_code"),u=(null===(o=e[0])||void 0===o?void 0:o.address_components)||[],l=sessionStorage.getItem("serviceableCity")||"",f=i===c.R.AUTO?(0,d.IB)("administrative_area_level_2",u)||(0,d.IB)("locality",u):l||(0,d.IB)("administrative_area_level_2",u)||(0,d.IB)("locality",u),v=(0,d.IB)("administrative_area_level_1",u),p=(0,d.IB)("country",u);r(!1),s?Xe({address:{zipcode:a,coordinate:{latitude:Number(t),longitude:Number(n)}}}):(Z(t),q(n),Y(a),je(f),G(f),Ke({city:f,state:v,pincode:a,country:p,lat:t,lng:n}),localStorage.setItem("pharmaAddressDetails",JSON.stringify({city:f,state:v,pincode:a,country:p,lat:t,lng:n})),localStorage.setItem("pharmaPincode",a))},ft=function(){var e=U(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a().get("".concat(u.vp,"?latlng=").concat(t,",").concat(n,"&key=").concat(u.ek)).then((function(e){var i=e.data;try{var s;if(null===i||void 0===i||null===(s=i.results)||void 0===s?void 0:s[0]){var o=i.results;return lt(o,t,n,r,ct),!0}throw Error("Google API failed to get current location details")}catch(a){}})).catch((function(e){return console.error(e,"Google API failed to get current location details"),!0}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),vt=function(){var e=U(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a().get("".concat(u.vp,"?address=").concat(t,"&components=country:in&key=").concat(u.ek)).then((function(e){var t=e.data;try{var r;if(null===t||void 0===t||null===(r=t.results)||void 0===r?void 0:r[0]){var i=t.results;return lt(i,A()(t.results[0],"geometry.location.lat",""),A()(t.results[0],"geometry.location.lng",""),n,ct),!0}}catch(s){}})).catch((function(e){return console.error(e,"Google API failed to fetch address details from pincode"),!0}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,P.useEffect)((function(){ct&&Me(!1)}),[ct]),(0,P.useEffect)((function(){b||(null===dt||void 0===dt?void 0:dt.length)!==d.Zm||(0,L.Zi)(dt).then((function(e){var t=e.serviceable;Ze(t)})).catch((function(e){Ze(!1)})).finally((function(){b=!0}))}),[dt]),(0,P.useEffect)((function(){!Re&&xe&&function(){if(ct)try{Ne(!0),xe&&function(e,t){var n=(null===e||void 0===e?void 0:e.find((function(e){return e.id===t})))||null;if(n){var r,i=n.zipcode,s=void 0===i?"":i,o=n.city,a=void 0===o?"":o,c=n.state,u=void 0===c?"":c,l=n.latitude,f=void 0===l?"":l,v=n.longitude,p=void 0===v?"":v,g=(null===f||void 0===f?void 0:f.toString())||"",P=(null===p||void 0===p?void 0:p.toString())||"";Ke({city:a,state:u,pincode:s,country:"",lat:g,lng:P}),localStorage.setItem("pharmaPincode",s),localStorage.setItem("pharmaAddressDetails",JSON.stringify({city:a,state:u,pincode:s,country:"",lat:g,lng:P})),N(n),(0,h.P1)({category:"Pharmacy",action:"Order",label:"Address Selected"}),(0,h.nx)({event:"Address Selected",PINCode:n.zipcode,City:n.city});var y=(0,m.kx)(qe),S=(0,d.Vu)();(0,C.R_)("Pharmacy Address Selected Success",{"Circle membership added":et?"Existing":tt?"Added":"Not Added","Delivery TAT":A()(y,[0,"orderTat"],""),TAT_Hrs:A()(y,[0,"hourDifference"],""),"Split cart":(null===qe||void 0===qe?void 0:qe.length)>1?"Yes":"No","Cart items":Je,"Delivery Address":n,"User type":(null===S||void 0===S||null===(r=S.source_meta_data)||void 0===r?void 0:r.purchase_type)||"","Delivery successful":"",Pincode:(null===n||void 0===n?void 0:n.zipcode)||"","TAT Displayed":A()(y,[0,"orderTat"],""),"CT source":"Web","Circle Membership Value":nt||"",City:(null===n||void 0===n?void 0:n.city)||""})}else N(null);Ge(!0)}(Ve,We)}catch(e){N(null),console.error("UPDATING PATIENT ADDRESS FAILED",e)}finally{Ne(!1)}}()}),[Re,xe,Ve,We,ct]),(0,P.useEffect)((function(){!xe&&ct&&rt.query({query:y.a2,variables:{patientId:ct},fetchPolicy:"no-cache"}).then((function(e){var t=A()(e,["data","getPatientAddressList","addressList"],[]),n=null===t||void 0===t?void 0:t.reverse().filter((function(e){return e.id}));Qe(n)})).catch((function(e){N(null),console.error("FETCHING ADDRESS DETAILS FAILED",e)})).finally((function(){Ne(!1),Me(!0)}))}),[xe,ct]),(0,P.useEffect)((function(){ot!==E.J.SIGNEDOUT||localStorage.getItem("pharmaAddressDetails")||(N(null),Ke({city:"",state:"",pincode:"",country:"",lat:"",lng:""}),localStorage.removeItem("pharmaPincode"),localStorage.removeItem("pharmaAddressDetails"))}),[ot]),(0,s.jsx)(_.Provider,{value:{editAddress:Ee,setEditAddress:ke,patientCurrentAddress:T,setPatientCurrentAddress:N,isPincodeServiceable:ze,setIsPincodeServiceable:Ze,isAddressListUpdated:xe,setIsAddressListUpdated:Me,isAddressUpdated:Re,setIsAddressUpdated:Ge,pickAddressMobileDialogOpen:Ie,setPickAddressMobileDialogOpen:he,pickAddressDesktopDialogOpen:Ce,setPickAddressDesktopDialogOpen:De,isAddAddressCartDialogOpen:_e,setIsAddAddressCartDialogOpen:be,isCartAddressLoading:Te,setIsCartAddressLoading:Ne,headerPincodeError:n,showPincodeModal:p,currentLocation:R,paymentPage:x,currentLat:z,currentLong:J,setCurrentLocation:G,setCurrentLat:Z,setCurrentLong:q,currentPincode:W,setCurrentPincode:Y,locateCurrentLocation:ut,getCurrentLocationPincode:ft,isUserDeniedLocationAccess:Pe,setIsUserDeniedLocationAccess:ye,placeId:K,setPlaceId:Q,city:$,setCity:ee,area:ce,setArea:de,country:se,setCountry:oe,state:ne,setState:re,setCityId:fe,cityId:le,stateId:pe,setStateId:Ae,setShowPincodeModal:k,setHeaderPincodeError:r,getPlaceDetailsPincode:vt},children:e.children})},T=function(){return(0,P.useContext)(_)}},69274:function(e,t,n){var r;n.d(t,{R:function(){return r}}),function(e){e.AUTO="AUTO",e.MANUAL="MANUAL"}(r||(r={}))}}]);